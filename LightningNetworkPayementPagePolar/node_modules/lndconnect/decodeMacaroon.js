'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _base64url = require('base64url');

var _base64url2 = _interopRequireDefault(_base64url);

var _decodeUriComponent = require('decode-uri-component');

var _decodeUriComponent2 = _interopRequireDefault(_decodeUriComponent);

var _untildify = require('untildify');

var _untildify2 = _interopRequireDefault(_untildify);

var _utils = require('./utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * decode a binary macaroon as a base64 decoded url string.
 * @param  {String} macaroonPath Path to macaroon file.
 * @return {String} decoded macaroon
 */
const decodeMacaroon = macaroonString => {
  if (!macaroonString) {
    return '';
  }

  const unescaped = (0, _decodeUriComponent2.default)(macaroonString);

  if ((0, _utils.isAbsolute)((0, _untildify2.default)(unescaped))) {
    return unescaped;
  }

  return _base64url2.default.toBuffer(unescaped).toString('hex');
};

exports.default = decodeMacaroon;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9kZWNvZGVNYWNhcm9vbi5qcyJdLCJuYW1lcyI6WyJkZWNvZGVNYWNhcm9vbiIsIm1hY2Fyb29uU3RyaW5nIiwidW5lc2NhcGVkIiwiYmFzZTY0dXJsIiwidG9CdWZmZXIiLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7Ozs7QUFLQSxNQUFNQSxpQkFBaUJDLGtCQUFrQjtBQUN2QyxNQUFJLENBQUNBLGNBQUwsRUFBcUI7QUFDbkIsV0FBTyxFQUFQO0FBQ0Q7O0FBRUQsUUFBTUMsWUFBWSxrQ0FBbUJELGNBQW5CLENBQWxCOztBQUVBLE1BQUksdUJBQVcseUJBQVVDLFNBQVYsQ0FBWCxDQUFKLEVBQXNDO0FBQ3BDLFdBQU9BLFNBQVA7QUFDRDs7QUFFRCxTQUFPQyxvQkFBVUMsUUFBVixDQUFtQkYsU0FBbkIsRUFBOEJHLFFBQTlCLENBQXVDLEtBQXZDLENBQVA7QUFDRCxDQVpEOztrQkFjZUwsYyIsImZpbGUiOiJkZWNvZGVNYWNhcm9vbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBiYXNlNjR1cmwgZnJvbSAnYmFzZTY0dXJsJ1xuaW1wb3J0IGRlY29kZVVyaUNvbXBvbmVudCBmcm9tICdkZWNvZGUtdXJpLWNvbXBvbmVudCdcbmltcG9ydCB1bnRpbGRpZnkgZnJvbSAndW50aWxkaWZ5J1xuaW1wb3J0IHsgaXNBYnNvbHV0ZSB9IGZyb20gJy4vdXRpbHMnXG5cbi8qKlxuICogZGVjb2RlIGEgYmluYXJ5IG1hY2Fyb29uIGFzIGEgYmFzZTY0IGRlY29kZWQgdXJsIHN0cmluZy5cbiAqIEBwYXJhbSAge1N0cmluZ30gbWFjYXJvb25QYXRoIFBhdGggdG8gbWFjYXJvb24gZmlsZS5cbiAqIEByZXR1cm4ge1N0cmluZ30gZGVjb2RlZCBtYWNhcm9vblxuICovXG5jb25zdCBkZWNvZGVNYWNhcm9vbiA9IG1hY2Fyb29uU3RyaW5nID0+IHtcbiAgaWYgKCFtYWNhcm9vblN0cmluZykge1xuICAgIHJldHVybiAnJ1xuICB9XG5cbiAgY29uc3QgdW5lc2NhcGVkID0gZGVjb2RlVXJpQ29tcG9uZW50KG1hY2Fyb29uU3RyaW5nKVxuXG4gIGlmIChpc0Fic29sdXRlKHVudGlsZGlmeSh1bmVzY2FwZWQpKSkge1xuICAgIHJldHVybiB1bmVzY2FwZWRcbiAgfVxuXG4gIHJldHVybiBiYXNlNjR1cmwudG9CdWZmZXIodW5lc2NhcGVkKS50b1N0cmluZygnaGV4Jylcbn1cblxuZXhwb3J0IGRlZmF1bHQgZGVjb2RlTWFjYXJvb25cbiJdfQ==