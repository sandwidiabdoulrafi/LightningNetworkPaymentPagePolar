'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _base64url = require('base64url');

var _base64url2 = _interopRequireDefault(_base64url);

var _decodeUriComponent = require('decode-uri-component');

var _decodeUriComponent2 = _interopRequireDefault(_decodeUriComponent);

var _untildify = require('untildify');

var _untildify2 = _interopRequireDefault(_untildify);

var _utils = require('./utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * decode a tls certificate from a base64 encoded url string.
 * @param  {String} certString base64url encoded string to decode
 * @return {String} decoded certificate
 */
const decodeCert = certString => {
  if (!certString) {
    return '';
  }

  const unescaped = (0, _decodeUriComponent2.default)(certString);

  if ((0, _utils.isAbsolute)((0, _untildify2.default)(unescaped))) {
    return unescaped;
  }

  const cert = _base64url2.default.toBase64(unescaped);
  var prefix = '-----BEGIN CERTIFICATE-----\n';
  var postfix = '-----END CERTIFICATE-----';
  return prefix + cert.match(/.{0,64}/g).join('\n') + postfix;
};

exports.default = decodeCert;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9kZWNvZGVDZXJ0LmpzIl0sIm5hbWVzIjpbImRlY29kZUNlcnQiLCJjZXJ0U3RyaW5nIiwidW5lc2NhcGVkIiwiY2VydCIsImJhc2U2NHVybCIsInRvQmFzZTY0IiwicHJlZml4IiwicG9zdGZpeCIsIm1hdGNoIiwiam9pbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7Ozs7QUFLQSxNQUFNQSxhQUFhQyxjQUFjO0FBQy9CLE1BQUksQ0FBQ0EsVUFBTCxFQUFpQjtBQUNmLFdBQU8sRUFBUDtBQUNEOztBQUVELFFBQU1DLFlBQVksa0NBQW1CRCxVQUFuQixDQUFsQjs7QUFFQSxNQUFJLHVCQUFXLHlCQUFVQyxTQUFWLENBQVgsQ0FBSixFQUFzQztBQUNwQyxXQUFPQSxTQUFQO0FBQ0Q7O0FBRUQsUUFBTUMsT0FBT0Msb0JBQVVDLFFBQVYsQ0FBbUJILFNBQW5CLENBQWI7QUFDQSxNQUFJSSxTQUFTLCtCQUFiO0FBQ0EsTUFBSUMsVUFBVSwyQkFBZDtBQUNBLFNBQU9ELFNBQVNILEtBQUtLLEtBQUwsQ0FBVyxVQUFYLEVBQXVCQyxJQUF2QixDQUE0QixJQUE1QixDQUFULEdBQTZDRixPQUFwRDtBQUNELENBZkQ7O2tCQWlCZVAsVSIsImZpbGUiOiJkZWNvZGVDZXJ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJhc2U2NHVybCBmcm9tICdiYXNlNjR1cmwnXG5pbXBvcnQgZGVjb2RlVXJpQ29tcG9uZW50IGZyb20gJ2RlY29kZS11cmktY29tcG9uZW50J1xuaW1wb3J0IHVudGlsZGlmeSBmcm9tICd1bnRpbGRpZnknXG5pbXBvcnQgeyBpc0Fic29sdXRlIH0gZnJvbSAnLi91dGlscydcblxuLyoqXG4gKiBkZWNvZGUgYSB0bHMgY2VydGlmaWNhdGUgZnJvbSBhIGJhc2U2NCBlbmNvZGVkIHVybCBzdHJpbmcuXG4gKiBAcGFyYW0gIHtTdHJpbmd9IGNlcnRTdHJpbmcgYmFzZTY0dXJsIGVuY29kZWQgc3RyaW5nIHRvIGRlY29kZVxuICogQHJldHVybiB7U3RyaW5nfSBkZWNvZGVkIGNlcnRpZmljYXRlXG4gKi9cbmNvbnN0IGRlY29kZUNlcnQgPSBjZXJ0U3RyaW5nID0+IHtcbiAgaWYgKCFjZXJ0U3RyaW5nKSB7XG4gICAgcmV0dXJuICcnXG4gIH1cblxuICBjb25zdCB1bmVzY2FwZWQgPSBkZWNvZGVVcmlDb21wb25lbnQoY2VydFN0cmluZylcblxuICBpZiAoaXNBYnNvbHV0ZSh1bnRpbGRpZnkodW5lc2NhcGVkKSkpIHtcbiAgICByZXR1cm4gdW5lc2NhcGVkXG4gIH1cblxuICBjb25zdCBjZXJ0ID0gYmFzZTY0dXJsLnRvQmFzZTY0KHVuZXNjYXBlZClcbiAgdmFyIHByZWZpeCA9ICctLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS1cXG4nXG4gIHZhciBwb3N0Zml4ID0gJy0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0nXG4gIHJldHVybiBwcmVmaXggKyBjZXJ0Lm1hdGNoKC8uezAsNjR9L2cpLmpvaW4oJ1xcbicpICsgcG9zdGZpeFxufVxuXG5leHBvcnQgZGVmYXVsdCBkZWNvZGVDZXJ0XG4iXX0=